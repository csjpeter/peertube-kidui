<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Content-Security-Policy" content="
        default-src     'self' 'unsafe-inline' 'unsafe-eval' blob: data:;
        media-src       'self' 'unsafe-inline' 'unsafe-eval' blob: data:;
        img-src         'self' 'unsafe-inline' 'unsafe-eval' blob: data:;
        font-src        'self' 'unsafe-inline' 'unsafe-eval' blob: data:;
        worker-src      'self' 'unsafe-inline' 'unsafe-eval' blob: data:;
        script-src      'self' 'unsafe-inline' 'unsafe-eval' blob: data:;
        script-src-elem 'self' 'unsafe-inline' 'unsafe-eval' blob: data:;
        script-src-attr 'self' 'unsafe-inline' 'unsafe-eval' blob: data:;
        style-src       'self' 'unsafe-inline' 'unsafe-eval' blob: data:;
        style-src-elem  'self' 'unsafe-inline' 'unsafe-eval' blob: data:;
    ">
    <title>Kid-Friendly PeerTube</title>
    <style>
        body, html {
            height: 100%;
            margin: 0;
            display: flex;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f4f4f4;
            color: #333;
            width: 100%;
        }

        #content-wrapper {
            display: flex;
            flex: 1;
            width: 100%;
            transition: transform 0.5s ease; /* Added transition for smooth rotation */
            transform-origin: top left; /* Set the origin for rotation */
        }

        #left-bar, #right-bar {
            width: 60px;
            background-color: #e0e0e0;
            padding: 20px 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: space-between;
            box-sizing: border-box;
        }

        #left-bar button, #right-bar button {
            transform: rotate(-90deg);
            white-space: nowrap;
            margin: 0;
            padding: 8px 12px;
            border: 1px solid #ccc;
            background-color: #f0f0f0;
            color: #555;
            cursor: pointer;
            border-radius: 5px;
            font-size: 14px;
            font-weight: 500;
            transition: background-color 0.3s ease;
        }

        #left-bar button:hover, #right-bar button:hover {
            background-color: #d0d0d0;
        }

        #left-bar button:nth-child(3),
        #right-bar button:nth-child(2) {
            transform: none;
            white-space: normal;
            font-size: 18px;
            padding: 10px 15px;
        }

        #main-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: flex-start;
            padding: 20px;
            overflow-y: auto;
            box-sizing: border-box;
        }

        #page-title h1, #page-title h4 {
            color: #444;
            margin-bottom: 15px;
            text-align: center;
        }

        #content-list {
            display: none;
            flex-wrap: wrap;
            justify-content: center;
        }

        .video-item, .list-item {
            margin: 15px;
            padding: 15px;
            border: 1px solid #ddd;
            text-align: center;
            cursor: pointer;
            width: 220px;
            box-sizing: border-box;
            background-color: white;
            border-radius: 8px;
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }

        .video-item:hover, .list-item:hover {
            transform: translateY(-5px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }

        .video-item img {
            max-width: 100%;
            height: auto;
            border-radius: 5px;
            margin-bottom: 10px;
        }

        #embed-container {
            width: 90%;
            max-width: none;
            margin: 20px 0;
            display: none;
            box-sizing: border-box;
        }

        #embed-player {
            width: 100%;
            height: calc(100vh - 150px);
            display: none;
            box-sizing: border-box;
            border: none;
        }

        #video-description {
            width: 90%;
            max-width: 1200px;
            margin-top: 20px;
            text-align: center;
            box-sizing: border-box;
            color: #666;
            font-size: 15px;
        }
    </style>
    <script>
        document.addEventListener("DOMContentLoaded", function() {
            const BASE_URL = `${window.location.protocol}//${window.location.hostname}`;
            const API_URL = `${window.location.protocol}//${window.location.hostname}/api/v1`;
            let currentVideos = [];
            let currentIndex = 0;
            let isRotated = false;

            function clearPage() {
                document.getElementById('page-title').innerHTML = '';
                document.getElementById('content-list').innerHTML = '';
                document.getElementById('content-list').style.display = 'none';

                const embedEl = document.getElementById('embed-player');
                embedEl.src = "";
                embedEl.style.display = 'none';
                const currDescEl = document.getElementById('video-description');
                currDescEl.innerHTML = `<p></p>`;
            }

            function showVideoList(videos) {
                currentVideos = videos;
                currentIndex = 0;

                const listEl = document.getElementById('content-list');
                listEl.style.display = 'flex';
                videos.forEach(video => {
                    let vid = video.video ?? video;

                    if (!vid || !vid.thumbnailPath || !vid.name) {
                        console.warn("Skipping invalid video entry:", vid);
                        return;
                    }

                    let div = document.createElement('div');
                    div.classList.add('video-item');
                    let thumbnailUrl = `${BASE_URL}${vid.thumbnailPath}`;
                    div.innerHTML = `<img src="${thumbnailUrl}" alt="Thumbnail"><br>${vid.name}`;
                    div.onclick = () => playVideo(vid);
                    listEl.appendChild(div);
                });
            }

            // suggested
            async function loadSuggestedVideos() {
                const response = await fetch(`${API_URL}/videos?sort=-views`);
                const data = await response.json();

                clearPage();

                const currChEl = document.getElementById('page-title');
                currChEl.innerHTML = `<h1>Ajánlatok</h1>`;
                currChEl.style.display = 'block';

                showVideoList(data.data);
            }
            window.loadSuggestedVideos = loadSuggestedVideos;

            // channels
            async function loadChannels() {
                const response = await fetch(`${API_URL}/video-channels`);
                const data = await response.json();
                let channels = data.data;

                clearPage();

                const currChEl = document.getElementById('page-title');
                currChEl.innerHTML = `<h1>Csatornák</h1>`;
                currChEl.style.display = 'block';

                const listEl = document.getElementById('content-list');
                listEl.style.display = 'flex';
                channels.forEach(channel => {
                    let div = document.createElement('div');
                    div.classList.add('list-item');
                    div.innerHTML = `${channel.displayName}`;
                    div.onclick = () => loadChannelVideos(channel);
                    listEl.appendChild(div);
                });
            }
            window.loadChannels = loadChannels;

            async function loadChannelVideos(channel) {
                let url = `${API_URL}/video-channels/${channel.name}/videos`;
                const response = await fetch(url);
                const data = await response.json();

                clearPage();

                const currChEl = document.getElementById('page-title');
                currChEl.innerHTML = `<h1>${channel.displayName}</h1>`;
                currChEl.style.display = 'block';

                loadPlaylists(channel);

                showVideoList(data.data);
            }

            // playlists
            async function loadPlaylists(channel) {
                const response = await fetch(`${API_URL}/video-channels/${channel.name}/video-playlists`);
                const data = await response.json();
                let playlists = data.data;

                const listEl = document.getElementById('content-list');
                listEl.style.display = 'flex';
                playlists.forEach(playlist => {
                    let div = document.createElement('div');
                    div.classList.add('list-item');
                    div.innerHTML = `${playlist.displayName}<br/>`;
                    div.onclick = () => loadPlaylistVideos(playlist);
                    listEl.prepend(div);
                });
            }

            async function loadPlaylistVideos(playlist) {
                let url = `${API_URL}/video-playlists/${playlist.id}/videos`;
                const response = await fetch(url);
                const data = await response.json();

                clearPage();

                const currPlEl = document.getElementById('page-title');
                currPlEl.innerHTML = `<h1>${playlist.displayName}</h1>`;
                currPlEl.style.display = 'block';

                showVideoList(data.data);
            }

            // play video
            function nextVideo() {
                if (currentIndex < currentVideos.length - 1) {
                    currentIndex++;
                    video = currentVideos[currentIndex];
                    let vid = video.video ?? video;
                    playVideo(vid);
                }
            }
            window.nextVideo = nextVideo;

            function prevVideo() {
                if (currentIndex > 0) {
                    currentIndex--;
                    video = currentVideos[currentIndex];
                    let vid = video.video ?? video;
                    playVideo(vid);
                }
            }
            window.prevVideo = prevVideo;

            function playVideo(video) {
                clearPage();

                currentIndex = currentVideos.findIndex(v => v.id === video.id);

                const currViEl = document.getElementById('page-title');
                currViEl.innerHTML = `<h4>${video.name}</h4>`;
                currViEl.style.display = 'none';

                const currDescEl = document.getElementById('video-description');
                if (video.description != null)
                    currDescEl.innerHTML = `<p>${video.description}</p>`;
                else
                    currDescEl.innerHTML = `<p></p>`;

                const playerContainer = document.getElementById('embed-container');
                playerContainer.style.display = 'flex';
                const embedEl = document.getElementById('embed-player');
                let path = video.embedPath + "?autoplay=true"
                embedEl.src = path;
                embedEl.style.display = 'block';
            }

            // discover
            async function loadDiscoverVideos() {
                const response = await fetch(`${API_URL}/videos/discover`);
                const data = await response.json();

                clearPage();

                const currChEl = document.getElementById('page-title');
                currChEl.innerHTML = `<h1>Felfedezés</h1>`;
                currChEl.style.display = 'block';

                showVideoList(data.data);
            }
            window.loadDiscoverVideos = loadDiscoverVideos;

            function rotateContent() {
                const contentWrapper = document.getElementById('content-wrapper');
                isRotated = !isRotated;
                if (isRotated) {
                    contentWrapper.style.transform = 'rotate(90deg)';
                } else {
                    contentWrapper.style.transform = 'rotate(0deg)';
                }
            }
            window.rotateContent = rotateContent;

            loadSuggestedVideos();
        });
    </script>
</head>
<body>
    <div id="content-wrapper">
        <div id="left-bar">
            <button onclick="loadSuggestedVideos()">Ajánlatok</button>
            <button onclick="loadDiscoverVideos()">Felfedezés</button>
            <button onclick="prevVideo()">&#8592;</button>
        </div>
        <div id="main-content">
            <div id="page-title"></div>

            <div id="content-list"></div>

            <div id="embed-container">
                <iframe id="embed-player" allowfullscreen></iframe>
            </div>

            <div id="video-description"></div>

        </div>
        <div id="right-bar">
            <button onclick="loadChannels()">Csatornák</button>
            <button onclick="nextVideo()">&#8594;</button>
            <button onclick="rotateContent()">Rotate</button>
        </div>
    </div>
</body>
</html>
